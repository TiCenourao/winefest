<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Wine Fest 2025 - Ingressos</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700&family=Roboto&display=swap');

    body {
      font-family: 'Roboto', sans-serif;
      background: linear-gradient(135deg, #4B1D3F, #8B3E5F);
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      margin: 0;
      color: #fff;
    }

    .card {
      background: #fff;
      color: #333;
      padding: 40px 30px;
      border-radius: 25px;
      max-width: 450px;
      width: 100%;
      text-align: center;
      box-shadow: 0 10px 30px rgba(0,0,0,0.3);
      animation: fadeIn 0.7s ease;
    }

    @keyframes fadeIn {
      from {opacity:0; transform: translateY(20px);}
      to {opacity:1; transform: translateY(0);}
    }

    h1 {
      font-family: 'Playfair Display', serif;
      font-size: 2.2rem;
      color: #5B1F2E;
      margin-bottom: 20px;
    }

    label {
      font-weight: bold;
      display: block;
      margin-bottom: 5px;
      font-size: 1rem;
      text-align: left;
    }

    input[type="text"],
    input[type="number"],
    input[type="tel"] {
      width: 100%;
      padding: 8px;
      border-radius: 10px;
      border: 1px solid #ccc;
      font-size: 1rem;
      margin-bottom: 10px;
    }

    button {
      margin-top: 10px;
      padding: 12px 30px;
      background: #8B1E3F;
      color: #fff;
      border: none;
      border-radius: 12px;
      font-size: 1rem;
      cursor: pointer;
      transition: background 0.3s;
    }

    button:hover {
      background: #5B1230;
    }

    #total {
      font-size: 1.3rem;
      margin: 15px 0;
      font-weight: bold;
      color: #C0392B;
    }

    #qr {
      margin: 20px auto;
      display: block;
      max-width: 250px;
      border: 5px solid #8B1E3F;
      border-radius: 15px;
      background: #fff;
      padding: 10px;
    }

    textarea {
      width: 100%;
      height: 80px;
      margin-top: 10px;
      border-radius: 12px;
      border: 1px solid #ccc;
      resize: none;
      padding: 10px;
      font-size: 0.9rem;
    }

    .button-group {
      display: flex;
      justify-content: space-between;
      gap: 10px;
      margin-top: 15px;
    }

  </style>
</head>
<body>
  <div class="card">
    <h1>üç∑ Wine Fest 2025</h1>

    <label>Nome do respons√°vel:</label>
    <input type="text" id="nome">

    <label>CPF:</label>
    <input type="text" id="cpf" placeholder="000.000.000-00">

    <label>Telefone:</label>
    <input type="tel" id="telefone" placeholder="+55 11 99999-9999">

    <label>Quantidade de ingressos:</label>
    <input type="number" id="qtd" value="1" min="1" max="50" onchange="validarQtd()">

    <p id="total">Total: R$ 0,05</p>

    <div class="button-group">
      <button onclick="gerar()">Gerar QR Pix</button>
      <button onclick="confirmar()">J√° paguei</button>
    </div>

    <img id="qr" width="250">
    <p>Copia e cole o Pix:</p>
    <textarea id="copia" readonly></textarea>
  </div>

  <script>
    let ultimoTxid = null;

    function validarQtd() {
      const qtdInput = document.getElementById("qtd");
      let qtd = parseInt(qtdInput.value) || 1;
      if (qtd < 1) qtd = 1;
      if (qtd > 50) qtd = 50;
      qtdInput.value = qtd;
    }

    async function gerar() {
      validarQtd();
      const nome = document.getElementById("nome").value.trim();
      const cpf = document.getElementById("cpf").value.trim();
      const telefone = document.getElementById("telefone").value.trim();
      if (!nome || !cpf || !telefone) {
        return alert("Preencha todos os campos de identifica√ß√£o.");
      }

      const qtd = parseInt(document.getElementById("qtd").value);
      const resp = await fetch(`/api/pix?qtd=${qtd}&nome=${encodeURIComponent(nome)}&cpf=${encodeURIComponent(cpf)}&telefone=${encodeURIComponent(telefone)}`);
      const data = await resp.json();

      document.getElementById("qr").src = data.qr;
      document.getElementById("copia").value = data.payload;
      document.getElementById("total").innerText = "Total: R$ " + data.total;
      ultimoTxid = data.txid;
    }

    async function confirmar() {
      if (!ultimoTxid) return alert("Gere o QR primeiro");
      const resp = await fetch("/api/confirmar", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ txid: ultimoTxid })
      });
      const data = await resp.json();
      if (data.error) alert(data.error);
      else alert("Pagamento confirmado!\nTxID: " + data.txid);
    }
  </script>
</body>
</html>
